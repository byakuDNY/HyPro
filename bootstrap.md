# My Next.js Template

A step-by-step guide to setting up **ESLint, Prettier, Drizzle ORM, ShadCN, and Better Auth** in a Next.js project.

---

## Install ESLint & Prettier

```sh
pnpm add -D eslint-config-prettier @trivago/prettier-plugin-sort-imports prettier prettier-plugin-tailwindcss eslint-plugin-check-file
```

## Setup ESLint

<details>
<summary><code>eslint.config.mjs</code></summary>

```ts
import { FlatCompat } from "@eslint/eslintrc";
import { dirname } from "path";
import { fileURLToPath } from "url";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript", "prettier"),
  {
    plugins: ["check-file"],
    rules: {
      "prefer-arrow-callback": "error",
      "prefer-template": "error",
      "check-file/filename-naming-convention": [
        "error",
        {
          "**/*.{ts,tsx}": "KEBAB_CASE",
        },
        {
          ignoreMiddleExtensions: true,
        },
      ],
      "check-file/folder-naming-convention": [
        "error",
        {
          "src/**": "KEBAB_CASE",
        },
      ],
    },
  },
];

export default eslintConfig;
```

</details>

## Setup Prettier

<details>
<summary><code>.prettierrc.json</code></summary>

```json
{
  "importOrder": [
    "^(react|next?/?([a-zA-Z/]*))$",
    "<THIRD_PARTY_MODULES>",
    "^@/(.*)$",
    "^[./]"
  ],
  "importOrderSeparation": true,
  "importOrderSortSpecifiers": true,
  "plugins": [
    "@trivago/prettier-plugin-sort-imports",
    "prettier-plugin-tailwindcss"
  ]
}
```

</details>

<!-- ## Setup VSCode Settings

<details>
<summary><code>.vscode/settings.json</code></summary>

```json
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll": true,
    "source.organizeImports": true
  },
  "files.associations": {
    "*.css": "tailwindcss"
  },
  "typescript.tsdk": "node_modules/typescript/lib"
}
``` -->

</details>

## Install ShadCN/UI

```sh
pnpm dlx shadcn@latest init
pnpm dlx shadcn@latest add button dropdown-menu
pnpm add next-themes
```

## Setup Theme Provider

<details>
<summary><code>./src/components/theme-provider.tsx</code></summary>

```tsx
"use client";

import * as React from "react";

import { ThemeProvider as NextThemesProvider } from "next-themes";

export function ThemeProvider({
  children,
  ...props
}: React.ComponentProps<typeof NextThemesProvider>) {
  return <NextThemesProvider {...props}>{children} </NextThemesProvider>;
}
```

</details>

<details>
<summary><code>./src/components/mode-toggle.tsx</code></summary>

```tsx
"use client";

import { Moon, Sun } from "lucide-react";
import { useTheme } from "next-themes";

import { Button } from "@/components/ui/button";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";

export function ModeToggle() {
  const { setTheme } = useTheme();

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button variant="outline" size="icon">
          <Sun className="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0" />
          <Moon className="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100" />
          <span className="sr-only">Toggle theme</span>
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end">
        <DropdownMenuItem onClick={() => setTheme("light")}>
          Light
        </DropdownMenuItem>
        <DropdownMenuItem onClick={() => setTheme("dark")}>
          Dark
        </DropdownMenuItem>
        <DropdownMenuItem onClick={() => setTheme("system")}>
          System
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  );
}
```

</details>

<details>
<summary><code>./src/app/layout.tsx</code></summary>

```tsx
import type { Metadata } from "next";

import { ThemeProvider } from "@/components/theme-provider";

import "./globals.css";

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body>
        <ThemeProvider
          attribute="class"
          defaultTheme="system"
          enableSystem
          disableTransitionOnChange
        >
          {children}
        </ThemeProvider>
      </body>
    </html>
  );
}
```

</details>

## Install Drizzle ORM

```sh
pnpm add drizzle-orm pg dotenv
pnpm add -D drizzle-kit tsx @types/pg
```

## Setup Environment Variables

<details>
<summary><code>.env</code></summary>

```env
BASE_URL=
DATABASE_URL=
GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=
BETTER_AUTH_SECRET=
```

</details>

## Setup Environment Configuration

<details>
<summary><code>./lib/env-config.ts</code></summary>

```ts
const envConfig = {
  baseUrl: process.env.BASE_URL!,
  db: { databaseUrl: process.env.DATABASE_URL! },
  auth: {
    betterAuth: { secret: process.env.BETTER_AUTH_SECRET! },
    githubOauth: {
      clientId: process.env.GITHUB_CLIENT_ID!,
      clientSecret: process.env.GITHUB_CLIENT_SECRET!,
    },
  },
};

export default envConfig;
```

</details>

## Setup Drizzle ORM

<details>
<summary><code>drizzle.config.ts</code></summary>

```ts
import { defineConfig } from "drizzle-kit";

import envConfig from "@/lib/env-config";

export default defineConfig({
  out: "./src/db/migrations",
  schema: "./src/db/schema.ts",
  dialect: "postgresql",
  dbCredentials: {
    url: envConfig.db.databaseUrl,
  },
  verbose: true,
  strict: true,
  casing: "snake_case",
});
```

</details>

<details>
<summary><code>./src/db/index.ts</code></summary>

```ts
import { drizzle } from "drizzle-orm/node-postgres";

import * as schema from "@/db/schema";
import envConfig from "@/lib/env-config";

const db = drizzle({
  connection: envConfig.db.databaseUrl,
  casing: "snake_case",
  schema,
});

export default db;
```

</details>

## Install Better Auth

```sh
pnpm add better-auth
```

## Setup Authentication

<details>
<summary><code>./lib/auth.ts</code></summary>

```ts
import { betterAuth } from "better-auth";
import { drizzleAdapter } from "better-auth/adapters/drizzle";

import db from "@/db";

import envConfig from "./env-config";

const auth = betterAuth({
  database: drizzleAdapter(db, {
    provider: "pg",
    usePlural: true,
  }),
  emailAndPassword: {
    enabled: true,
  },
  socialProviders: {
    github: {
      clientId: envConfig.auth.githubOauth.clientId,
      clientSecret: envConfig.auth.githubOauth.clientSecret,
    },
  },
  session: {
    expiresIn: 60 * 60 * 24 * 7, // 7 days
    updateAge: 60 * 60 * 24, // 1 day
    cookieCache: {
      enabled: true,
      maxAge: 5 * 60, // Cache duration in seconds
    },
  },
  rateLimit: {
    window: 10,
    max: 20,
    customRules: {
      "/sign-in": { window: 10, max: 5 },
      "/sign-up": { window: 10, max: 5 },
    },
  },
});

export type Session = typeof auth.$Infer.Session;
export default auth;
```

</details>

<details>
<summary><code>./lib/auth-client.ts</code></summary>

```ts
import { createAuthClient } from "better-auth/react";

import envConfig from "./env-config";

export const authClient = createAuthClient({
  baseURL: envConfig.baseUrl,
});
```

</details>

<details>
<summary><code>./src/app/api/auth/[...all]/route.ts</code></summary>

```ts
import { toNextJsHandler } from "better-auth/next-js";

import auth from "@/lib/auth";

export const { POST, GET } = toNextJsHandler(auth);
```

</details>
